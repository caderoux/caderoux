<html>
<head>
<title>Web QR</title>

<style type="text/css">
body{
    width:100%;
    text-align:center;
}
img{
    border:0;
}
#main{
    margin: 15px auto;
    background:white;
    overflow: auto;
	width: 750px;
}
#header{
    background:white;
}
#mainbody{
    background: white;
    width:100%;
}
#footer{
    background:white;
}
#mp1{
    text-align:center;
    font-size:35px;
}
#header ul{
    margin-bottom:0;
    margin-right:40px;
}
#header li{
    display:inline;
    padding-right: 0.5em;
    padding-left: 0.5em;
    font-weight: bold;
    border-right: 1px solid #333333;
}
#header li a{
    text-decoration: none;
    color: black;
}
p.quote1{
    
    font-weight:bold;
    margin-left:10%;
    margin-right:10%;
    color: black;
}
a{
	color: black;
}

div.button{
    border: 2px solid #333333;;
    border-radius:15px;
    width:100px;
    cursor:pointer;
    font-weight:bold;
}

</style>
<script type="text/javascript">

const IncludeInQR = [
    { AgentStats : 'username' }
    ,{ AgentStats : 'faction' }
    ,{ AgentStats : 'ap' }
    ,{ AgentStats : 'trekker' }
]

const StatsDefs = [
{ Niantic : 'Time Span', AgentStats : '' }
,{ Niantic : 'Agent Name', AgentStats : 'username' }
,{ Niantic : 'Agent Faction', AgentStats : 'faction' }
,{ Niantic : 'Date (yyyy-mm-dd)', AgentStats : '' }
,{ Niantic : 'Time (hh:mm:ss)', AgentStats : '' }
,{ Niantic : 'Lifetime AP', AgentStats : '' }
,{ Niantic : 'Current AP', AgentStats : 'ap' }
,{ Niantic : 'Unique Portals Visited', AgentStats : 'explorer' }
,{ Niantic : 'Portals Discovered', AgentStats : 'seer' }
,{ Niantic : 'Seer Points', AgentStats : '' }
,{ Niantic : 'XM Collected', AgentStats : '' }
,{ Niantic : 'OPR Agreements', AgentStats : '' }
,{ Niantic : 'Distance Walked', AgentStats : 'trekker' }
,{ Niantic : 'Resonators Deployed', AgentStats : 'builder' }
,{ Niantic : 'Links Created', AgentStats : 'connector' }
,{ Niantic : 'Control Fields Created', AgentStats : 'mind-controller' }
,{ Niantic : 'Mind Units Captured', AgentStats : 'illuminator' }
,{ Niantic : 'Longest Link Ever Created', AgentStats : '' }
,{ Niantic : 'Largest Control Field', AgentStats : '' }
,{ Niantic : 'XM Recharged', AgentStats : 'recharger' }
,{ Niantic : 'Portals Captured', AgentStats : 'liberator' }
,{ Niantic : 'Unique Portals Captured', AgentStats : 'pioneer' }
,{ Niantic : 'Mods Deployed', AgentStats : 'engineer' }
,{ Niantic : 'Resonators Destroyed', AgentStats : 'purifier' }
,{ Niantic : 'Portals Neutralized', AgentStats : '' }
,{ Niantic : 'Enemy Links Destroyed', AgentStats : '' }
,{ Niantic : 'Enemy Fields Destroyed', AgentStats : '' }
,{ Niantic : 'Max Time Portal Held', AgentStats : 'guardian' }
,{ Niantic : 'Max Time Link Maintained', AgentStats : '' }
,{ Niantic : 'Max Link Length x Days', AgentStats : '' }
,{ Niantic : 'Max Time Field Held', AgentStats : '' }
,{ Niantic : 'Largest Field MUs x Days', AgentStats : '' }
,{ Niantic : 'Unique Missions Completed', AgentStats : 'specops' }
,{ Niantic : 'Hacks', AgentStats : 'hacker' }
,{ Niantic : 'Glyph Hack Points', AgentStats : 'translator' }
,{ Niantic : 'Longest Hacking Streak', AgentStats : 'sojourner' }
,{ Niantic : 'Mission Day(s) Attended', AgentStats : 'missionday' }
,{ Niantic : 'NL-1331 Meetup(s) Attended', AgentStats : '' }
,{ Niantic : 'First Saturday Events', AgentStats : '' }
,{ Niantic : 'Intel Ops Missions', AgentStats : '' }
,{ Niantic : 'Recursions', AgentStats : '' }
]

const FactionTranslation = [
{ Niantic : 'Resistance', AgentStats : 'res' }
,{ Niantic : 'Enlightened', AgentStats : 'enl' }
]

function tsvObj(tsv){
 var lines=tsv.split("\n");
 var result = [];
 var headers=lines[0].split("\t");
 for(var i=1;i<lines.length;i++){
     var obj = {};
     var currentline=lines[i].split("\t");
     for(var j=0;j<headers.length;j++){
         var AgentStats = StatsDefs.filter(e => e.Niantic === headers[j] && e.AgentStats != '');
         if (AgentStats.length > 0) {
            if ( IncludeInQR.some(e => e.AgentStats === AgentStats[0].AgentStats) ) {
                if (FactionTranslation.some(e => e.Niantic === currentline[j])) {
                obj[AgentStats[0].AgentStats] = FactionTranslation.filter(e => e.Niantic === currentline[j])[0].AgentStats;
             }
             else {
                obj[AgentStats[0].AgentStats] = currentline[j];
             }
            }
         }
     }
     result.push(obj);
 }
 return (result);
}

function headings(tsv){
 var lines=tsv.split("\n");
 var headers=lines[0].split("\t");
 return (headers.join('\n'));
}

function parse()
{
    var rawdata=document.getElementById("rawdata").value;
    var stats = tsvObj(rawdata);
    document.getElementById("data").value = JSON.stringify(stats);
    // document.getElementById("data").value = headings(rawdata);
}

function create()
{
    var data=document.getElementById("data").value;
    document.getElementById("qrimage").innerHTML="<img src='https://chart.googleapis.com/chart?chs=250x250&cht=qr&chl="+encodeURIComponent(data)+"'/>";
}

</script>
</head>

<body >
<div id="main">
<div id="header">
<p id="mp1">
QR Code scanner
</p>
<ul>
<li><a href="index.html">Scan</a></li>
<li><a href="create.html">Create</a></li>
</ul>
</div>
<div id="mainbody">
<p style="font-size:25px;text-align:center;">Create QR Code</p>
<table border="0" align="center">
<tr><td>
<p style="font-size:20px;text-align:center;">Paste:</p>
<textarea cols="40" rows="3" id="rawdata"></textarea>
<textarea cols="40" rows="3" id="data"></textarea>
</td></tr>
<tr><td align="center">
<div class="button" onclick="parse()">Parse</div>
<div class="button" onclick="create()">Create</div>
</td></tr>
<tr><td align="center">
<div id="qrimage">
</div>
</td></tr>

</table>
</div>
<div id="footer">
<br>
</div>
</div>
</body>

</html>
